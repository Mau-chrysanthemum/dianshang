(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["EditGoods"],{"6b21":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"title"},[t._v("修改商品信息")]),a("el-steps",{attrs:{space:200,active:t.active,"finish-status":"success"}},[a("el-step",{attrs:{title:"步骤 1"}}),a("el-step",{attrs:{title:"步骤 2"}}),a("el-step",{attrs:{title:"步骤 3"}}),a("el-step",{attrs:{title:"步骤 4"}}),a("el-step",{attrs:{title:"步骤 5"}})],1),a("el-form",{ref:"updateGoodsForm",attrs:{model:t.goodsObj,rules:t.rules,"label-width":"150px"}},[a("el-tabs",{attrs:{value:"base","tab-position":"left"},on:{"tab-click":t.tabClick}},[a("el-tab-pane",{attrs:{name:"base",label:"基本信息"}},[a("el-form-item",{attrs:{label:"商品名称",prop:"goods_name"}},[a("el-input",{model:{value:t.goodsObj.goods_name,callback:function(e){t.$set(t.goodsObj,"goods_name",e)},expression:"goodsObj.goods_name"}})],1),a("el-form-item",{attrs:{label:"商品价格",prop:"goods_price"}},[a("el-input",{model:{value:t.goodsObj.goods_price,callback:function(e){t.$set(t.goodsObj,"goods_price",e)},expression:"goodsObj.goods_price"}})],1),a("el-form-item",{attrs:{label:"商品数量",prop:"goods_number"}},[a("el-input",{model:{value:t.goodsObj.goods_number,callback:function(e){t.$set(t.goodsObj,"goods_number",e)},expression:"goodsObj.goods_number"}})],1),a("el-form-item",{attrs:{label:"商品分类",prop:"goods_cat"}},[a("el-cascader",{attrs:{props:t.props,"show-all-levels":!1,options:t.options},on:{change:t.categoryChange},model:{value:t.selectedOptions,callback:function(e){t.selectedOptions=e},expression:"selectedOptions"}})],1),a("el-form-item",{attrs:{label:"是否促销"}},[a("el-radio",{attrs:{label:1,border:""},model:{value:t.goodsObj.is_promote,callback:function(e){t.$set(t.goodsObj,"is_promote",e)},expression:"goodsObj.is_promote"}},[t._v("是")]),a("el-radio",{attrs:{label:0,border:""},model:{value:t.goodsObj.is_promote,callback:function(e){t.$set(t.goodsObj,"is_promote",e)},expression:"goodsObj.is_promote"}},[t._v("否")])],1)],1),a("el-tab-pane",{attrs:{name:"params",label:"商品参数"}},t._l(t.dparams,function(e){return a("el-form-item",{key:e.attr_id,attrs:{label:e.attr_name}},[a("el-checkbox-group",{model:{value:e.attr_vals,callback:function(a){t.$set(e,"attr_vals",a)},expression:"item.attr_vals"}},t._l(e.attr_vals,function(t,e){return a("el-checkbox",{key:e,attrs:{border:"",label:t}})}),1)],1)}),1),a("el-tab-pane",{attrs:{name:"property",label:"商品属性"}},t._l(t.sproperty,function(e){return a("el-form-item",{key:e.attr_id,attrs:{label:e.attr_name}},[a("el-input",{model:{value:e.attr_vals,callback:function(a){t.$set(e,"attr_vals",a)},expression:"item.attr_vals"}})],1)}),1),a("el-tab-pane",{attrs:{name:"picture",label:"商品图片"}},[a("el-upload",{attrs:{action:"http://127.0.0.1:8888/api/private/v1/upload",headers:t.headers,"on-preview":t.handlePreview,"on-remove":t.handleRemove,"on-success":t.handleSuccess,"file-list":t.goodsObj.pics,name:"file","list-type":"picture"}},[a("el-button",{attrs:{type:"success",plain:"",icon:"el-icon-upload"}},[t._v("上传")]),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传jpg/png文件，且不超过500kb")])],1)],1),a("el-tab-pane",{attrs:{name:"content",label:"商品内容"}},[a("quill-editor",{model:{value:t.goodsObj.goods_introduce,callback:function(e){t.$set(t.goodsObj,"goods_introduce",e)},expression:"goodsObj.goods_introduce"}})],1)],1)],1),a("div",{staticClass:"footer"},[a("el-button",{on:{click:function(e){t.$router.go(-1)}}},[t._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:t.updateGoods}},[t._v("修改")])],1),a("el-dialog",{attrs:{visible:t.dialogVisible4Preview,width:"50%"},on:{"update:visible":function(e){t.dialogVisible4Preview=e}}},[a("img",{attrs:{src:t.previewImageUrl,alt:""}})])],1)},o=[],r=(a("20d6"),a("7f7f"),a("28a5"),a("ac6a"),a("953d")),i={components:{quillEditor:r["quillEditor"]},data:function(){return{active:0,goodsObj:{},rules:{goods_name:[{required:!0,message:"请输入商品名称",trigger:"blur"}],goods_price:[{required:!0,message:"请输入商品价格",trigger:"blur"}],goods_number:[{required:!0,message:"请输入商品数量",trigger:"blur"}],goods_cat:[{required:!0,message:"请选择商品分类",trigger:"blur"}]},options:[],selectedOptions:[],props:{value:"cat_id",label:"cat_name",children:"children"},cat_id:null,dparams:[],sproperty:[],headers:{Authorization:localStorage.getItem("mytoken")},previewImageUrl:"",dialogVisible4Preview:!1}},created:function(){this.getCategoriesData(),this.getGoodsData()},methods:{getGoodsData:function(){var t=this;this.$axios.get("goods/".concat(this.$route.query.goods_id)).then(function(e){t.selectedOptions=[e.data.data.cat_one_id,e.data.data.cat_two_id,e.data.data.cat_three_id],t.cat_id=e.data.data.cat_id,e.data.data.pics.forEach(function(t,e){t.name="第".concat(e+1,"张"),t.url=t.pics_mid_url});var a=e.data.data.attrs.filter(function(t){return"many"===t.attr_sel});a.forEach(function(t){0===t.attr_value.trim().length?t.attr_vals=[]:t.attr_vals=t.attr_value.split(",")}),t.dparams=a,t.sproperty=e.data.data.attrs.filter(function(t){return"only"===t.attr_sel}),t.goodsObj=e.data.data})},tabClick:function(t){switch(t.name){case"base":this.active=0;break;case"params":this.active=1,this.getThreeLevelParamsOrPropertyData("many");break;case"property":this.active=2,this.getThreeLevelParamsOrPropertyData("only");break;case"picture":this.active=3;break;case"content":this.active=4;break;default:break}},getThreeLevelParamsOrPropertyData:function(t){var e=this;if(this.cat_id)if(this.goodsObj.cat_id===this.cat_id)if("many"===t){var a=this.goodsObj.attrs.filter(function(t){return"many"===t.attr_sel});a.forEach(function(t){0===t.attr_value.trim().length?t.attr_vals=[]:t.attr_vals=t.attr_value.split(",")}),this.dparams=a}else"only"===t&&(this.sproperty=this.goodsObj.attrs.filter(function(t){return"only"===t.attr_sel}));else this.$axios.get("categories/".concat(this.cat_id,"/attributes"),{params:{sel:t}}).then(function(a){"many"===t?(a.data.data.forEach(function(t){0===t.attr_vals.trim().length?t.attr_vals=[]:t.attr_vals=t.attr_vals.split(",")}),e.dparams=a.data.data):"only"===t&&(e.sproperty=a.data.data)});else this.$message.error("请选择三级分类")},getCategoriesData:function(){var t=this;this.$axios.get("categories",{params:{type:3}}).then(function(e){t.options=e.data.data})},categoryChange:function(t){t.length<3?this.$message.error("请选择三级分类"):(this.goodsObj.goods_cat=t.join(","),this.cat_id=t[t.length-1])},handleSuccess:function(t,e,a){200===t.meta.status&&(this.goodsObj.pics.push({pic:t.data.tmp_path,url:t.data.url}),this.goodsObj.pics.forEach(function(t,e){t.name="第".concat(e+1,"张")}))},handlePreview:function(t){this.previewImageUrl=t.url,this.dialogVisible4Preview=!0},handleRemove:function(t,e){var a=t.url,s=this.goodsObj.pics.findIndex(function(t){return t.pic===a});this.goodsObj.pics.splice(s,1)},updateGoods:function(){var t=this;this.$refs.updateGoodsForm.validate(function(e){e&&(t.goodsObj.attrs=t.dparams.concat(t.sproperty),t.$axios.put("goods/".concat(t.goodsObj.goods_id),t.goodsObj).then(function(e){200===e.data.meta.status&&(t.$message({message:e.data.meta.msg,type:"success"}),t.$router.go(-1))}))})}}},l=i,n=(a("c34f"),a("2877")),c=Object(n["a"])(l,s,o,!1,null,"7629d4cb",null);e["default"]=c.exports},c34f:function(t,e,a){"use strict";var s=a("eb6b"),o=a.n(s);o.a},eb6b:function(t,e,a){}}]);